# 山水社区数据库设计文档

本文档仅供描述数据库表设计及涉及到的业务关联，如有更新，请同步本文档，并描述归档时间

- [x] 用户体系
- [x] 账户体系
- [ ] 社交群

## 用户体系表
```mysql
DROP TABLE IF EXISTS TB_USR_USER;
CREATE TABLE TB_USR_USER
(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	USER_CODE       VARCHAR(50)       NOT NULL                  COMMENT '用户编码',
	USER_NAME       VARCHAR(50)       NOT NULL DEFAULT ''       COMMENT '姓名',
	USER_ALIAS      VARCHAR(50)       NOT NULL                  COMMENT '别名',
	USER_TYPE       VARCHAR(30)       NOT NULL DEFAULT 'NONE'   COMMENT '用户类型',
	DISABLED        INT(5)            NOT NULL DEFAULT 1        COMMENT '是否有效 0-失效 其他-有效',
	CREATE_DATE     DATETIME          NOT NULL DEFAULT NOW()    COMMENT '建档时间',
	UPDATE_DATE     DATETIME          NOT NULL DEFAULT NOW()    COMMENT '修改时间',
	UPDATE_PERSON   VARCHAR(30)       NOT NULL                  COMMENT '修改人',
	CONSTRAINT UQ_USR_USER UNIQUE (USER_CODE)
)
COMMENT '用户信息表' CHARSET=UTF8MB4;

CREATE INDEX IDX_TB_USR_USER_USER_CODE ON TB_USR_USER (USER_CODE);
CREATE INDEX IDX_TB_USR_USER_USER_TYPE ON TB_USR_USER (USER_TYPE);
```

```mysql
DROP TABLE IF EXISTS TB_USR_USER_ATTR;
CREATE TABLE TB_USR_USER_ATTR
(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	USER_CODE       VARCHAR(50)         NOT NULL                COMMENT '用户编码',
	ATTR_TYPE       VARCHAR(30)         NOT NULL                COMMENT '属性类型',
    ATTR_CODE       VARCHAR(50)         NOT NULL                COMMENT '属性编码',
    ATTR_VALUE      VARCHAR(1000)       NOT NULL                COMMENT '属性值',
	CREATE_DATE     DATETIME            NOT NULL DEFAULT NOW()  COMMENT '建档时间'
)
COMMENT '用户属性表' CHARSET=UTF8MB4;

CREATE INDEX IDX_TB_USR_USER_ATTR_USER_CODE ON TB_USR_USER_ATTR (USER_CODE);
```

```mysql
DROP TABLE IF EXISTS TB_USR_USER_LOGIN;
CREATE TABLE TB_USR_USER_LOGIN
(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	USER_CODE       VARCHAR(30)         NOT NULL                COMMENT '用户编码',
	LOGIN_TYPE      VARCHAR(30)         NOT NULL                COMMENT '登录类型',
	LOGIN_NAME      VARCHAR(50)         NOT NULL                COMMENT '登录名',
    PASSWORD        VARCHAR(50)         NOT NULL DEFAULT ''     COMMENT '用户密码',
	DISABLED        INT(5)              NOT NULL DEFAULT 1      COMMENT '是否有效 0-失效 其他-有效',
	CREATE_DATE     DATETIME            NOT NULL DEFAULT NOW()  COMMENT '建档时间',
	REMARK          VARCHAR(255)        NOT NULL                COMMENT '备注',

	CONSTRAINT UQ_USR_USER_LOGIN_NAME UNIQUE (LOGIN_NAME),
	CONSTRAINT UQ_USR_USER_LOGIN_USER_CODE UNIQUE (USER_CODE, LOGIN_TYPE)
)
COMMENT '用户登录信息表' CHARSET=UTF8MB4;

CREATE INDEX IDX_TB_USR_USER_LOGIN_USER_CODE ON TB_USR_USER_LOGIN (USER_CODE);
CREATE INDEX IDX_TB_USR_USER_LOGIN_LOGIN_TYPE ON TB_USR_USER_LOGIN (LOGIN_TYPE);
```

```mysql
DROP TABLE IF EXISTS TB_USR_USER_AUTH;
CREATE TABLE TB_USR_USER_AUTH
(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	USER_CODE           VARCHAR(30)     NOT NULL                COMMENT '用户编码',
	REAL_NAME           VARCHAR(30)     NOT NULL                COMMENT '真实姓名',
	USER_TYPE           VARCHAR(30)     NOT NULL DEFAULT 'NONE' COMMENT '用户类型',
	ID_CARD_NO          VARCHAR(50)     NOT NULL                COMMENT '身份证号',
	ID_CARD_POSITIVE    VARCHAR(255)    NOT NULL                COMMENT '身份证正面照片',
	ID_CARD_NEGATIVE    VARCHAR(255)    NOT NULL                COMMENT '身份证反面照片',
	SELF_PHOTO          VARCHAR(255)    NOT NULL                COMMENT '本人照片',
	DISABLED            INT(5)          NOT NULL DEFAULT 1      COMMENT '是否有效 0-失效 其他-有效',
	CREATE_DATE         DATETIME        NOT NULL DEFAULT NOW()  COMMENT '建档时间',

	CONSTRAINT UQ_USR_USER_AUTH_ID_CARD_NO UNIQUE (ID_CARD_NO),
	CONSTRAINT UQ_USR_USER_AUTH_USER_CODE UNIQUE (USER_CODE)
)
COMMENT '用户实名认证信息表' CHARSET=UTF8MB4;

CREATE INDEX IDX_TB_USR_USER_AUTH_USER_CODE ON TB_USR_USER_AUTH (USER_CODE);
CREATE INDEX IDX_TB_USR_USER_AUTH_REAL_NAME ON TB_USR_USER_AUTH (REAL_NAME);
CREATE INDEX IDX_TB_USR_USER_AUTH_ID_CARD_NO ON TB_USR_USER_AUTH (ID_CARD_NO);
```

## 资金账户

```mysql
DROP TABLE IF EXISTS TB_ACT_ACCOUNT;
CREATE TABLE TB_ACT_ACCOUNT
(
	ID INT AUTO_INCREMENT PRIMARY KEY,
    USER_CODE           VARCHAR(30)     NOT NULL                COMMENT '用户编码',
	ACCOUNT_CODE        VARCHAR(50)     NOT NULL                COMMENT '账户编码',
	ACCOUNT_TYPE        VARCHAR(30)     NOT NULL                COMMENT '账户类型',
	ACCOUNT_BALANCE     VARCHAR(30)     NOT NULL                COMMENT '账户余额',
	DISABLED            INT(5)          NOT NULL DEFAULT 1      COMMENT '是否有效 0-失效 其他-有效',
	CREATE_DATE         DATETIME        NOT NULL DEFAULT NOW()  COMMENT '建档时间',
	CONSTRAINT UQ_ACT_USER_CODE UNIQUE (USER_CODE),
    CONSTRAINT UQ_ACT_ACCOUNT_CODE UNIQUE (ACCOUNT_CODE)
)
COMMENT '账户信息表' CHARSET=UTF8MB4;

CREATE INDEX IDX_ACT_ACCOUNT_BILL_ACCOUNT ON TB_ACT_ACCOUNT (USER_CODE);
```

```mysql
DROP TABLE IF EXISTS TB_ACT_ACCOUNT_BILL;
CREATE TABLE TB_ACT_ACCOUNT_BILL
(
	ID INT AUTO_INCREMENT PRIMARY KEY,
    ACCOUNT_CODE    VARCHAR(50)     NOT NULL                    COMMENT '账户编码',
	ACCOUNT_TYPE    VARCHAR(30)     NOT NULL                    COMMENT '账户类型',
	BILL_ID         VARCHAR(50)     NOT NULL                    COMMENT '账单流水号',
	FEE_ITEM        VARCHAR(30)     NOT NULL                    COMMENT '费用项',
	FEE             DECIMAL(10,2)   NOT NULL                    COMMENT '变动金额',
	BALANCE         DECIMAL(10,2)   NOT NULL                    COMMENT '账户余额',
	BILL_NOTE       VARCHAR(1000)   NOT NULL                    COMMENT '费用说明',
	BILL_DATE       DATETIME        NOT NULL DEFAULT NOW()      COMMENT '累账时间',
	STATUS          VARCHAR(10)     NOT NULL DEFAULT '1'        COMMENT '状态',
	CONSTRAINT UQ_ACT_ACCOUNT_BILL UNIQUE (BILL_ID)
)
COMMENT '账户账单表' CHARSET=UTF8MB4;

CREATE INDEX IDX_ACT_ACCOUNT_BILL_FEE_ITEM ON TB_ACT_ACCOUNT_BILL (FEE_ITEM);
CREATE INDEX IDX_ACT_ACCOUNT_BILL_ACCOUNT_CODE ON TB_ACT_ACCOUNT_BILL (ACCOUNT_CODE);
```

```mysql
DROP TABLE IF EXISTS TB_ACT_ACCOUNT_SETTLE;
CREATE TABLE TB_ACT_ACCOUNT_SETTLE
(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	BILL_DAY        VARCHAR(30)         NOT NULL    COMMENT '账单日账期',
	SETTLE_NO       VARCHAR(50)         NOT NULL    COMMENT '结算单号',
	ACCOUNT_CODE    VARCHAR(50)         NOT NULL    COMMENT '账户编码',
	ACCOUNT_TYPE    VARCHAR(30)         NOT NULL    COMMENT '账户类型',
	TOTAL_COUNT     INT                 NOT NULL    COMMENT '总账单数',
	BEFORE_AMOUNT   DECIMAL(10,2)       NOT NULL    COMMENT '结算前余额',
	TOTAL_AMOUNT    DECIMAL(10,2)       NOT NULL    COMMENT '结算金额',
	AFTER_AMOUNT    DECIMAL(10,2)       NOT NULL    COMMENT '结算后余额',
	SETTLE_DATE     DATETIME            NOT NULL    COMMENT '结算时间',
	SETTLE_NOTE     VARCHAR(1000)       NOT NULL    COMMENT '结算说明',
	CONSTRAINT UQ_ACT_ACCOUNT_SETTLE UNIQUE (SETTLE_NO)
)
COMMENT '账户计费账单结算表';

CREATE INDEX IDX_ACT_ACCOUNT_SETTLE_ACCOUNT ON TB_ACT_ACCOUNT_SETTLE (ACCOUNT_CODE);
CREATE INDEX IDX_ACT_ACCOUNT_SETTLE_BILL_DAY ON TB_ACT_ACCOUNT_SETTLE (BILL_DAY, ACCOUNT_CODE);
```